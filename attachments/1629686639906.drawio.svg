<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="356px" height="1121px" viewBox="-0.5 -0.5 356 1121" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; version=&quot;8.5.3&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram&gt;7VpLb9s4EP4te+CxC70lHiVbbg/ZYoFgsdtToMas7UIWXZlO7P31O0NSD0pKoiaOrQILBAg55JAU+c0Mv6GJO9seP5bZbv0HX7KcONbySNw5cRzbcyz4h5KTlkTUU5JVuVlqWSO43fzLtFArrg6bJdsbHQXnudjsTOE9Lwp2LwxZVpb80ez2jefmrLtsxXqC2/ss70v/3izFWkkj32rkn9hmta5mti3dss2qzlqwX2dL/tgSuSlxZyXnQpW2xxnLcfeqfVF6iyda64WVrBBjFByl8JDlB/1tel3iVH0sW8K36yovxZqveJHlaSNNSn4olgxHtKDW9LnhfAdCG4TfmRAnfZDZQXAQrcU21639VesP2fNDea/X4SoRLqfVR3/WR8a3TJQn6FCyPBObB/OoMn3iq7pfrfon38CsjqXh6VZHU4PTMocQWbliQms1WwuF1jIakdzw4c13+5uf+iRaEBpgIUkJDUkakIgSWAQU6AzKO8ZK0CrArEgaEhqTyMPu8ZzQSA7gkDjCpigmSSAHsEhky6ZIDhmR2JZ9FiSBIWemOpR9nORuL3gJUIb/mTjsdW8KpxXkcEzJV1hGsMISST2SJKCm1x/FWhUNk5Xbep35vsATygpoenpyVLlTnbpgbKCGuHlcbwS73WUSIo/gbEbC6oGVgh2fRZFudSwTDRUYHhuzdzwtW7dMPrCexp2BmGfg4f06tulrJyxNw/TV57PXsfvmD5gVRQOI5hJiKYkCidgILQSMIQEkWojRmJIkRoNJPELTFkIDEi8Q2EorjlcANbSiVCpKYRIDFreTA+xFERtMG7EGPP3rhBO/u8/KjM4RTsIB3AforwHNWAgkWCOEciLjSmJjrBgVKHp9pobzyLsgzqNrwJodN+KfVvkLDvW7r2vzox5ZVk5VpYAvq5Ww0tLCaqMma5XeKKdfeXjDrN7nlhaXZXZqddihueyftjovMtHhda/BL/S3rdDqAEIt4bW2SaftGV86Vte+VjCvVtPaORVnrd9kzfr8180NcRd9h7Tm269wa72GM3LHBt0ut3jVDtm9HZoutpxLuIzRO9dnvxpbClpY+QAcJ9siZCTTKdhRTC720UvGPrvPWjHkTG5TbOuiu/ILkTV7iK2FVzPCcXTtddfWVoqhm1ap+Z8qWDW3K9mPA9uLVm4lxEs0cD2kgTBTKDMwMBK1cHXNJEAgZ/jXG3Iwm+KjTuTrgeJEckopRA5KcZGJV69CzammUpmSOUncNcuWd3J02E7dSidnioE10hLrPOmbADVxFmqYYtg3xetZ4hCBBPh5hC6klYFxwaw/EGvODKMkWhOVNqjsy5aWi8YowRxiUpBSA6RTw2Z40SgRTRuaRkRwzo3DcQkS2vUB50uQ2H3XeEHeXpHzn+LtdeWcvH3oEn72bO2reLvtdcAQPs/bu/07PP/NtN3ps89JGWz7WIeM+GrUyumT0rSQ2x5j4Bh4QVIPRypl6WOmsvqSO/loNLGw8cG5YNgYeiicEgrfO0R4XpfavVuIGHo8mtJWGwYf9A3+7K8aozE6cOtWT9fAtxQzS/RbcJ/jKJo0Nx7c8K3b0ndIZDyK0/molcyRMSEBdOD+2fYSzzxMK06WtGhd92F94AVwam7HvuRr3kDS+sv/FyjSZMMvcF3+6QtUYALGd1+4QAXPXrjefIFy+xeoz5N1qIPnejWP6vavUNqRxtV7biwzZOgOXdlEZc5sTKqszpDVrjfAX+CAok5HBcbPcsA/Ymc5Y+whuZ/Yi4tH3+/FBarND/KUDTS/a3TT/wA=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 187 160 L 187 193.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 198.88 L 183.5 191.88 L 187 193.63 L 190.5 191.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="100" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,102.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得所有peer node的存储状态列表，存入peer_storage_status；<br />以及storage term的lsn range，存入term_range</div></div></foreignObject></switch></g><path d="M 187 360 L 187 393.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 398.88 L 183.5 391.88 L 187 393.63 L 190.5 391.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="300" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(99.5,323.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="174" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 176px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">遍历上述空洞，每个gap记为item</div></div></foreignObject></switch></g><path d="M 187 580 L 187 613.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 618.88 L 183.5 611.88 L 187 613.63 L 190.5 611.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="860" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(126.5,883.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="120" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 121px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新请求状态列表状态</div></div></foreignObject></switch></g><path d="M 307 440 L 347 440 L 347 1090 L 313.37 1090" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 308.12 1090 L 315.12 1086.5 L 313.37 1090 L 315.12 1093.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 480 L 187 500 L 187 490 L 187 503.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 508.88 L 183.5 501.88 L 187 503.63 L 190.5 501.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 400 L 307 440 L 187 480 L 67 440 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(147.5,433.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 78px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item != NULL?</div></div></foreignObject></switch></g><path d="M 187 1020 L 187 1053.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1058.88 L 183.5 1051.88 L 187 1053.63 L 190.5 1051.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="960" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(140.5,983.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 94px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item = item-&gt;next</div></div></foreignObject></switch></g><rect x="67" y="1060" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(177.5,1083.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 20px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">exit</div></div></foreignObject></switch></g><path d="M 187 720 L 187 753.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 758.88 L 183.5 751.88 L 187 753.63 L 190.5 751.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="620" width="240" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,649.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">遍历请求状态列表，取得上一个request的目标peer后，第一个peer_storage_status包含gap区间的peer（即head_peer_id）</div></div></foreignObject></switch></g><path d="M 187 820 L 187 853.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 858.88 L 183.5 851.88 L 187 853.63 L 190.5 851.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="760" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(83.5,783.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="206" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 206px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">生成req_id, 并发送gap给head_peer_id</div></div></foreignObject></switch></g><path d="M 187 920 L 187 953.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 958.88 L 183.5 951.88 L 187 953.63 L 190.5 951.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 67 990 L 7 990 L 7 440 L 60.63 440" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 65.88 440 L 58.88 443.5 L 60.63 440 L 58.88 436.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 60 L 187 93.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 98.88 L 183.5 91.88 L 187 93.63 L 190.5 91.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="0" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(146.5,16.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="80" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 82px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Entry: <br />参数 target_lsn</div></div></foreignObject></switch></g><path d="M 187 260 L 187 293.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 298.88 L 183.5 291.88 L 187 293.63 L 190.5 291.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="200" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(82.5,216.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="208" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 210px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">找到term区间中，最终补齐点target_lsn<br />以下的所有空洞</div></div></foreignObject></switch></g><path d="M 67 550 L 27 550 L 27 990 L 60.63 990" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 65.88 990 L 58.88 993.5 L 60.63 990 L 58.88 986.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(23.5,764.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">Y</div></div></foreignObject></switch></g><path d="M 187 590 L 187 610 L 187 600 L 187 613.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 618.88 L 183.5 611.88 L 187 613.63 L 190.5 611.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(182.5,599.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">N</div></div></foreignObject></switch></g><path d="M 187 510 L 307 550 L 187 590 L 67 550 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(83.5,543.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="206" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 208px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">判断当前请求状态表中是否存在此gap?</div></div></foreignObject></switch></g></g></svg>