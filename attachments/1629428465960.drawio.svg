<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="356px" height="1241px" viewBox="-0.5 -0.5 356 1241" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; version=&quot;8.5.3&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram&gt;1VpLj+M2DP4tPejQQwu/Ix3txNkepkWBQdH2FHgTbezCsVJbmUn660tKsh0/spuZzeQBDCYSRcoS9ZEmKRN3utl/KpNt+qtY8Zw41mpP3BlxHNtzLPhBykFTJszThHWZrQxTS3jO/uOGaOTWu2zFqw6jFCKX2bZLXIqi4EvZoSVlKV67bF9E3n3qNlnzAeF5meRD6p/ZSqaaSn2rpf/Cs3VaP9m2zMgmqZkNoUqTlXg9IrkxcaelEFK3Nvspz1F5tV603PzEaLOwkhfyHAHXrOMlyXdmc2Zh8lDvlq9g86YrSpmKtSiSPG6pUSl2xYrjlBb0Wp4nIbZAtIH4D5fyYE4y2UkBpFRucjM6XLbZSSV25dKswzUnnZRrbrh8TcIVHomZrX7iYsNleQCGkueJzF66x5cYFKwbvlZR0DC6OqG3odpin9A5YQE2opiwCYkDQhmhFjbYFNpbzkuQKsAgSDwhLCTUQ/ZwRhhVEzgkpDhEQxIFagKLUFsNUTUlJaGteOYkgimnXXFo+/iQRSVFCSiE30TuKsPNQM9BDqqLPsMygjW2SOyRKAIxs34aGlHUNC83zTrzqkBFJgUMnX44iiw0Ux9GLUjwxF/TTPLnbaIO9xXcxJmAeOGl5PuvHrYZdWqjM07Gpqb/2pqs4xlaemSugfX9+PAex6z8oVnZwa3syh+1KwSbpcAGlgGQZWgTdKZQFxMaXMCG+qYLDZjQVUPwuBmgdXN3kHauCWn6OJBmI5C2bwVpNtAbYukncMDJBiGi3LBymQt52KLfRS5kxNO2Gj79f9jtOfSRySvQ1SIVeWfuL0lewXrmQ1CnYvMZ3hm3ALRvnQloegFA2w8U+9TwPYa0czNI16v5RvgzISEjUYguOPIIixXPVFEYMkTeGjEVIiz9MeCqmGOKDx6OFXwvh+w/3p2PDpwr+mjbeSBIj8Tztwvo7bGIPsCQGaCLDcCwpUIHCBpUaB/ZGGqcFWcMeXQ8Hpb83wWswJljQ2Yb8NDzlCerhQrit6Ia+vfesKW9+XJXorI17c4sgAXXtIAHirwvH2Yb0d9FBo9tDsR1Trxl6ym0CRqpnq6bZZynfv8W2ub7TP511P4bp/rZN73Z3sysOoe6U8CmGiHsHElhtxVTvVruTSfbiUDZh5x2WJbJ4Yhhi6dYnQaDR7tg8PoVom/w2w6zeiDRS3g3ZIKBxepky/pB+7bf/nh6urdA1T0387pIoDp5IJ9Gr4H8szU3TFoNtjS0TsSVd/cKte2rvkOHKSu6zvvTinNNrTgPlC46Y+mieysrdMbSxWEN732x9cka3nFIDDR4a8FzMCed4h+WvamqKqpGGI6WzVW+Sn0jH0aYrw6S2KZErsr77YJg1hiXAsPRDNqdBamn6tw4hEFP3QkMgv2OyFE6EXpK9n0a0xueDWuciseBbarTsZDYMgeovuaaQN9uMF8lRQHKwl5H16M0o3d3Z+5jcm5mbvfj5XcZwQOl5mNXbfbt3MdYag7A8gibK/ABvq06k8ZqkUI2U2agwWrXgLaVAU/wxouxjnEFytInxtJR4tio7w269KovvgdKqUdvs+jNkDt2nTUsKp1zedX33gbIPTZdSx28RvoXAKCfcnd/Dtm2rgrr4BYorksVdT3iTaWKpnPJUsVYwvYxham3lipsr58Fsa/XKvoCvdrGd5cqRu7y7tcTjpzr7V7hwzw8LpTaxx1W/TGK00aZY2xLUVRZJXmxPCzUxyqwHj9S36DkVWHraKDuOsSf3Z3L+8ALfLxVaL4j02Bvv8Zz4/8B&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 187 160 L 187 193.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 198.88 L 183.5 191.88 L 187 193.63 L 190.5 191.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="100" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,102.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得所有peer node的存储状态列表，存入peer_storage_status；<br />以及storage term的lsn range，存入term_range</div></div></foreignObject></switch></g><path d="M 187 260 L 187 293.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 298.88 L 183.5 291.88 L 187 293.63 L 190.5 291.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="200" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(85.5,223.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="202" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 204px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">开始遍历存储状态列表，取得当前item</div></div></foreignObject></switch></g><path d="M 187 500 L 187 533.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 538.88 L 183.5 531.88 L 187 533.63 L 190.5 531.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 420 L 307 460 L 187 500 L 67 460 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(116.5,446.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="140" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 142px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item-&gt;range_type == 0 &amp;&amp;<br />item-&gt;sent_hole == false?</div></div></foreignObject></switch></g><path d="M 187 600 L 187 633.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 638.88 L 183.5 631.88 L 187 633.63 L 190.5 631.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="540" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,556.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得空洞区间gap: [item-&gt;lsn, item-&gt;next-&gt;lsn)</div></div></foreignObject></switch></g><path d="M 187 940 L 187 973.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 978.88 L 183.5 971.88 L 187 973.63 L 190.5 971.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="880" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,889.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新请求状态列表状态：req_id/req_time/head_peer_pos<br />head_peer_pos = current_pos</div></div></foreignObject></switch></g><path d="M 187 380 L 187 413.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 418.88 L 183.5 411.88 L 187 413.63 L 190.5 411.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 307 340 L 347 340 L 347 1210 L 313.37 1210" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 308.12 1210 L 315.12 1206.5 L 313.37 1210 L 315.12 1213.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 300 L 307 340 L 187 380 L 67 340 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(147.5,333.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 78px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item != NULL?</div></div></foreignObject></switch></g><path d="M 187 1140 L 187 1173.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1178.88 L 183.5 1171.88 L 187 1173.63 L 190.5 1171.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="1080" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(140.5,1103.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 94px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item = item-&gt;next</div></div></foreignObject></switch></g><rect x="67" y="1180" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(177.5,1203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 20px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">exit</div></div></foreignObject></switch></g><path d="M 187 740 L 187 773.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 778.88 L 183.5 771.88 L 187 773.63 L 190.5 771.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="640" width="240" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,655.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="68" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">遍历请求状态列表，取得current_pos后第一个peer_storage_status包含gap区间的peer，设置current_pos为此node<br />current_pos表示请求状态列表中当前被选中接受数据请求的node</div></div></foreignObject></switch></g><path d="M 187 840 L 187 873.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 878.88 L 183.5 871.88 L 187 873.63 L 190.5 871.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="780" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,796.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">生成req_id, 并发送gap给current_pos指向的peer</div></div></foreignObject></switch></g><path d="M 187 1040 L 187 1073.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1078.88 L 183.5 1071.88 L 187 1073.63 L 190.5 1071.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="980" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(114.5,996.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="144" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 144px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新存储状态表中gap状态: <br />sent_hole = true</div></div></foreignObject></switch></g><path d="M 67 1110 L 7 1110 L 7 340 L 60.63 340" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 65.88 340 L 58.88 343.5 L 60.63 340 L 58.88 336.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 60 L 187 93.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 98.88 L 183.5 91.88 L 187 93.63 L 190.5 91.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="0" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(78.5,9.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="216" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 216px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Entry: <br />参数 <br />consistency_term/[term_lsn1, term_lsn2]</div></div></foreignObject></switch></g></g></svg>