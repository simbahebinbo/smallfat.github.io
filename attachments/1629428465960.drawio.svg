<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="356px" height="1241px" viewBox="-0.5 -0.5 356 1241" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; version=&quot;8.5.3&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram&gt;1VpLj+M2DP4tPejQQwtbfsQ62onTHqZFgUHR9hR4E23iwrFSW5lJ+utLynIcW0onM5vJA1jsSBSpB/WRIukQb7ze/VRlm9UvYsELQp3FjngTQqnrUwf+IGXfUEbMbwjLKl9opo7wnP/LNVHLLbf5gtc9RilEIfNNnzgXZcnnskfLqkq89tm+iqK/6iZbcoPwPM8Kk/pHvpCrhhoFTkf/mefLVbuy6+iRddYya0K9yhbi9YjkpcQbV0LIprXejXmBymv10shNT4weNlbxUp4j4Ol9vGTFVh9Ob0zu29PyBRxed0UlV2IpyqxIO2pSiW254DilA72O50mIDRBdIP7Npdzrm8y2UgBpJdeFHm3WxIVOnkOTarGt5prL01efVUuuuYKDDgF8XKy5rPbAUvEik/lLf/ZMo2B54OsUBQ2tqxN6M9WWBiSaEhZiI0kJG5E0JBEjkYMNNob2hvMKpEowCJKOCItJ5CN7PCEsUhNQEkc4FMUkCdUEDolcNRSpKSMSu4pnShKYctwXh3agZk5IoihJTJiPy85qKSrAJfzN5LY2Lrm7QryP11Uu+fMmU5p+BSO2XZfldl54JfnuiGRehR6lrUloF+BGuv/aGRT1NW11ZEyh8+23598R6N/AeGBi3A2t5nIF1AdW1CMOHYVDwG1CUoaIjSYKkCmJwgsgfGhY0IAJPTUEy00Areu7gzS9JqSjx4E0s0DavRWkmaE3xNIPhIbZGiGylKiXrATPKfcbDqzIhYx4286Br/nf7BYo/wW8fqhmskxeg65mK1H05v6aFTXsZ2qCeiXWX8B/3wLQgXMmoKMLANq9p8jkDUS38D2GNL0ZpNvdvBGcjEjMMD4AF5z4hKWKZ6woDBkSf4mYihGWgQ24RV0SOsaFzbGS76TJ/v3d+eiQXtFHu/SBIG0Jrtv3/waQtsXboQpzfdUADDsqdICgQQXeiYuhxllxhsmjIg8WV/yfGeyATrEh8zV46OmKZ4uZCqg3ojb9+2DYabz5fFuhshvanVkAC69pAQ8UeV8+zNaiv4kclj1ciEdPvLLtFI0JaqmBrg/bOE/9wS20zXe5/POo/RdO9WOge5Odnll19m2nhEMdhLBzJIXdTkz1Wrl33WwvAmWfcttxVWX7I4YN3mJ9Ggx+1AeDP6zfvMHvUuYMQNJs4cOQCQ2LbZIt57vGt/36+9PTvQWq3rmZ10UC1dED+bToGsg/W3Nm0qqx1UDrRFx5d0+o6171DTVTVnSd96cVek2t0AdKF6ktXfRuZYXUli6aNbyPxdYna3jHITHQ4NWCdTAnHeO/1Mf6NVYVVSOObSXsJl+NAi0fJ5ivGknsodCuiu/dhmDWFLcCw8kE2r0NqVWb3DiGQV9V7I1gvydylE7EvpL9mMaaA0/MGqfioXBMdTsOEjvmENUXB62e1aIsUElRiLJwVut+lGaa092Z+xidm5m7w3j5Q0bwQKm57buXezv3YUvNAVg+YVMFPsC302bSWC1SyGbKDBqwui2gXWXAYI8JYaxnXKGy9JG2dJQ4Nup7g2501YfvgVJq69es6GbItX3OMotK53y8GnpvDeQBW1NLNZ6R4QcA0E+1vT+H7DpXhXV4CxS3pYq2HvGuUsWhc8lShS1h+5zC1HtLFa4/zILY/9cqhgKD2sY3lyos3/Ju5wnf+1sWarlo71qO0MzD01Kp3e6w9MMd0S7KtLHNRVnnteTlfD+TvFrjfoIEW7OiLt0mGmi7lASTS7g8w79ZNH/+Q/55Dg+/Khx+5dWAvfutnJf+Bw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 187 160 L 187 193.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 198.88 L 183.5 191.88 L 187 193.63 L 190.5 191.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="100" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,116.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得所有peer node的存储状态列表，存入相应peer_storage_status</div></div></foreignObject></switch></g><path d="M 187 260 L 187 293.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 298.88 L 183.5 291.88 L 187 293.63 L 190.5 291.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="200" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(85.5,223.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="202" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 204px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">开始遍历存储状态列表，取得当前item</div></div></foreignObject></switch></g><path d="M 187 500 L 187 533.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 538.88 L 183.5 531.88 L 187 533.63 L 190.5 531.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 420 L 307 460 L 187 500 L 67 460 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(116.5,446.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="140" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 142px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item-&gt;range_type == 0 &amp;&amp;<br />item-&gt;sent_hole == false?</div></div></foreignObject></switch></g><path d="M 187 600 L 187 633.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 638.88 L 183.5 631.88 L 187 633.63 L 190.5 631.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="540" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,556.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得空洞区间gap: [item-&gt;lsn, item-&gt;next-&gt;lsn)</div></div></foreignObject></switch></g><path d="M 187 940 L 187 973.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 978.88 L 183.5 971.88 L 187 973.63 L 190.5 971.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="880" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,889.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新请求状态列表状态：req_id/req_time/head_peer_pos<br />head_peer_pos = current_pos</div></div></foreignObject></switch></g><path d="M 187 380 L 187 413.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 418.88 L 183.5 411.88 L 187 413.63 L 190.5 411.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 307 340 L 347 340 L 347 1210 L 313.37 1210" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 308.12 1210 L 315.12 1206.5 L 313.37 1210 L 315.12 1213.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 300 L 307 340 L 187 380 L 67 340 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(147.5,333.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 78px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item != NULL?</div></div></foreignObject></switch></g><path d="M 187 1140 L 187 1173.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1178.88 L 183.5 1171.88 L 187 1173.63 L 190.5 1171.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="1080" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(140.5,1103.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 94px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item = item-&gt;next</div></div></foreignObject></switch></g><rect x="67" y="1180" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(177.5,1203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 20px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">exit</div></div></foreignObject></switch></g><path d="M 187 740 L 187 773.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 778.88 L 183.5 771.88 L 187 773.63 L 190.5 771.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="640" width="240" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,655.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="68" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">遍历请求状态列表，取得current_pos后第一个peer_storage_status包含gap区间的peer，设置current_pos为此node<br />current_pos表示请求状态列表中当前被选中接受数据请求的node</div></div></foreignObject></switch></g><path d="M 187 840 L 187 873.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 878.88 L 183.5 871.88 L 187 873.63 L 190.5 871.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="780" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,796.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">生成req_id, 并发送gap给current_pos指向的peer</div></div></foreignObject></switch></g><path d="M 187 1040 L 187 1073.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1078.88 L 183.5 1071.88 L 187 1073.63 L 190.5 1071.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="980" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(114.5,996.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="144" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 144px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新存储状态表中gap状态: <br />sent_hole = true</div></div></foreignObject></switch></g><path d="M 67 1110 L 7 1110 L 7 340 L 60.63 340" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 65.88 340 L 58.88 343.5 L 60.63 340 L 58.88 336.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 60 L 187 93.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 98.88 L 183.5 91.88 L 187 93.63 L 190.5 91.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="0" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(78.5,9.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="216" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 216px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Entry: <br />参数 <br />consistency_term/[term_lsn1, term_lsn2]</div></div></foreignObject></switch></g></g></svg>