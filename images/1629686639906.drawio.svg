<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="356px" height="1341px" viewBox="-0.5 -0.5 356 1341" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; version=&quot;8.5.3&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram&gt;1Vpfb+M2DP8se9DDHjr4f6RHO3G3h24YcBi2eyp8jS7J4Fg5R2mTffqRkmzHlnNNe6njAIerRFGUQv1IkZSJP13vfy2zzfJ3Mec58Zz5nvgz4nlu4DnwBykHQ6Es0JRFuZobWkP4tPqPG6KZuNit5nzbYpRC5HK1aROfRFHwJ9miZWUpXtpsX0XeXnWTLbhF+PSU5Tb179VcLjWVhk5D/42vFstqZdcxI+usYjaE7TKbi5cjkp8Sf1oKIXVrvZ/yHLVX6UXPuz8xWm+s5IU8Z4If6hnPWb4zP85sTB6qX8vn8ONNV5RyKRaiyPK0oSal2BVzjiId6DU8D0JsgOgC8V8u5cGcZLaTAkhLuc7NqF4TFzr5OwxpK3blk+HyzdFn5YIbLt+tlQjw42LNZXkAnpLnmVw9t8VnBgaLmq/RFDSMsk4oztZbGhJ6T1iEjSQlbELSiFBGqIMNNoX2hvMSZhVgEiSdEBYTGiB7PCOMKgEeiSkO0ZgkkRLgEOqqIapEUhK7iueeJCBy2p4O7RAXedxKUQIM4W8md1vrTJsTQ/W/LFeSf9pkSrEvYLR9p9NzGM+8lHx/RLIVb0a9ygKMyVPTfWnMxwsMbXlkOpHz40cVjAjiryA6tBHtBr3GMQDEe1wDInuqAA1AA5AmJGUITzpT6EsJjS4A564VQQME+moIlpsBWNejQ/SgkI5uB9ITG9LsWoieWGpDKN0RL8rWiJCFRLVkBfhNedhwYEUuZMTDdmo+/b/dzXH+F/DwkZLUI3wLqnpcirwl+2uWb2E/9zaml2L9Bbz3NfAcOmfimV4Az/R28Mx6XPTVAM3OikImJGYkidH9JgFhqeKZKgpDhiRYIKBixGTYh9p8WxBviuvaYwXfS5v959H558gb0D9XicotANqtMqgjRFfh7fCIrnbTgjREzwlCFxuAYUeFDRAwqAg7cTHMOCvGsHjGBlIWDQlS74ZAevEo2Ez9U6xg2fpAfO/ELViJ0FZiZnV0XW/jPPX719A236/kP0ftzyjql9D0ZnsjWXUOVaeAH1VPws7RLOw201Svmvemk21dqJMPOe24LLPDEcMGT3F7GgwBbYMh6BZTXuF3PeZ0QKK38G7I2KmszoWcn3Qk+cdfDw9jCyT9cxOjSwSS7pjqWa8hPxoC+Wdrzs4pDbY0tE6EfqO7Ql130DvUTinRdY5PK96gWrmhfM7tSegqvitYYV9GZ5fY3hf+fqfEFpCEogTTcEwjjkv+bce38qhaPcFgPE5xpRhWmqiaNkiCuw521ywCWecU/1ki++rTOiOloREUJ5iRWmlqvQu9pl5KFxpnJPGXPJs/KumgTjPKRmeKk3MTUbcbe74HUN4NZaJeTybqXs0Uvb5MFPAXEHavzAysC1b9hmBTxRFlTkwZoTYwV5kuWqNCMyA4IYy1UDo2cNIhr4kKijeBzZ7HxipkugI2+54f7SrJOS8x9e2gvfPMQLXDpouDVoW7W84G/ZSwobGh2nUGhXVwDRRXiX2Vvb8psa87l0zs+9KbjynjvDWxd4NuzsC+n9l3J3QqAT+c2Pe9tY7WE/ac69XKxT0voWmh1N7vsMzVTLW7DNFLwraL+aN64nDu1DWuP9ZwzI2NAaZ2kiHe5/gUrYZARjK+6PJuyGeOsb/btSB6cYyeKAJ2fUs3ite2dIkKsn9Dsb3fcyThtbyG3xfaU0xqIR1Gq5+ZBPd8P6DTTUhOMYGdqoDqfd/BqEVj5ajAOSX6sTbGVLv6vguZgWKy/tbqlSdrsnAV1bGg/nbGTsdtcdYXELWTGZGjcz/wexvoNp9gasNsvmT10/8B&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 187 160 L 187 193.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 198.88 L 183.5 191.88 L 187 193.63 L 190.5 191.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="100" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,116.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得所有peer node的存储状态列表，存入peer_storage_status</div></div></foreignObject></switch></g><path d="M 187 360 L 187 393.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 398.88 L 183.5 391.88 L 187 393.63 L 190.5 391.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="300" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(85.5,323.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="202" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 204px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">开始遍历存储状态列表，取得当前item</div></div></foreignObject></switch></g><path d="M 187 600 L 187 633.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 638.88 L 183.5 631.88 L 187 633.63 L 190.5 631.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 520 L 307 560 L 187 600 L 67 560 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(116.5,546.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="140" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 142px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item-&gt;range_type == 0 &amp;&amp;<br />item-&gt;sent_hole == false?</div></div></foreignObject></switch></g><path d="M 187 700 L 187 733.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 738.88 L 183.5 731.88 L 187 733.63 L 190.5 731.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="640" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,656.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">取得空洞区间gap: [item-&gt;lsn, item-&gt;next-&gt;lsn)</div></div></foreignObject></switch></g><path d="M 187 1040 L 187 1073.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1078.88 L 183.5 1071.88 L 187 1073.63 L 190.5 1071.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="980" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(126.5,1003.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="120" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 121px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新请求状态列表状态</div></div></foreignObject></switch></g><path d="M 187 480 L 187 513.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 518.88 L 183.5 511.88 L 187 513.63 L 190.5 511.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 307 440 L 347 440 L 347 1310 L 313.37 1310" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 308.12 1310 L 315.12 1306.5 L 313.37 1310 L 315.12 1313.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 400 L 307 440 L 187 480 L 67 440 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(147.5,433.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 78px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item != NULL?</div></div></foreignObject></switch></g><path d="M 187 1240 L 187 1273.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1278.88 L 183.5 1271.88 L 187 1273.63 L 190.5 1271.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="1180" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(140.5,1203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 94px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">item = item-&gt;next</div></div></foreignObject></switch></g><rect x="67" y="1280" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(177.5,1303.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 20px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">exit</div></div></foreignObject></switch></g><path d="M 187 840 L 187 873.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 878.88 L 183.5 871.88 L 187 873.63 L 190.5 871.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="740" width="240" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,769.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">遍历请求状态列表，取得上一个request的目标peer后，第一个peer_storage_status包含gap区间的peer（即head_peer_id）</div></div></foreignObject></switch></g><path d="M 187 940 L 187 973.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 978.88 L 183.5 971.88 L 187 973.63 L 190.5 971.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="880" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(83.5,903.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="206" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 206px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">生成req_id, 并发送gap给head_peer_id</div></div></foreignObject></switch></g><path d="M 187 1140 L 187 1173.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 1178.88 L 183.5 1171.88 L 187 1173.63 L 190.5 1171.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="1080" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(114.5,1096.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="144" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 144px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">更新存储状态表中gap状态: <br />sent_hole = true</div></div></foreignObject></switch></g><path d="M 67 1210 L 7 1210 L 7 440 L 60.63 440" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 65.88 440 L 58.88 443.5 L 60.63 440 L 58.88 436.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 60 L 187 93.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 98.88 L 183.5 91.88 L 187 93.63 L 190.5 91.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="0" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(116.5,16.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="140" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 142px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Entry: <br />参数 end_lsn - 最终补齐点</div></div></foreignObject></switch></g><path d="M 187 260 L 187 293.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 187 298.88 L 183.5 291.88 L 187 293.63 L 190.5 291.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="67" y="200" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(68.5,209.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="236" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 236px; white-space: nowrap; overflow-wrap: normal; text-align: center;" class="xsj_foreignObject xsj_drawio_foreignObject"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">设置最终补齐点：在存储状态列表末尾加入节点：end_lsn，且前一个节点range_type = 0</div></div></foreignObject></switch></g></g></svg>