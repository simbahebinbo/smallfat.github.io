---
title: 并发控制与分布式事务总结解惑
tags: 
grammar_cjkRuby: true
---
# 一直以来疑惑的点
- 并发控制与事务隔离性的关系是什么？
- MVCC与事务隔离性的关系是什么？
- MVCC与snapshot based isolation有没有关系？
- 通用的分布式事务理论体系有没有？
- 目前，通用的并发控制的一般方法是什么？
- 目前，通用的分布式事务一致性/隔离性实现方法是什么？
- pg隔离性具体实现的问题：
	- lost update现象产生的原因？
	- snapshot based isolation 与lock based的控制开关在哪里？
	- 不同的隔离级别，对应同一段MVCC实现代码，由哪里控制隔离级别？
	
	
# 单机并发控制的难点在哪里？
- 事务看到的数据不合理
	- 脏读 dirty read : 一个事务读到了其他事务未提交的数据
	
	- 不可重复读 unrepeated read: 	一个事务内，最开始读到的数据和事务结束前的任意时刻读到的同一批数据出现不一致的情况

	- 幻读 phansm read
```
	幻读，并不是说两次读取获取的结果集不同
	
	幻读侧重的方面是某一次的 select 操作得到的结果所表征的数据状态无法支撑后续的业务操作。
	
	更为具体一些：select 某记录是否存在，不存在，准备插入此记录，但执行 insert 时发现此记录已存在，无法插入，此时就发生了幻读。
	
	不可重复读侧重表达 读-读，幻读则是说 读-写，用写来证实读的是鬼影。
```

# 通用的并发控制的一般方法是什么？
- 古老的方法：2PL (2 Phase Locking)：基于lock的方式， 只有读读之间可以并发，读写，写读，写写都要阻塞。效率低，被MVCC取代
- MVCC (Multi Version Concurrency Control)：多版本并发控制。类似于CopyOnWrite，同一事务先后产生的更改不会覆盖，而是保留多个版本。
	- 两种不同类型的MVCC
		- 事务ID + 活跃事务表
		- timestamp


# 分布式系统并发控制的难点在哪里？
- 存在与单机系统同样的难点
- 分布式系统中，去中心化场景下无法产生全局一致性ID，即MVCC中的一致性版本号 (比如事务ID或者timestamp)，没有全局一致性ID，就无法比较事务发生的先后顺序。

# 通用的分布式事务并发控制的实现方法是什么？
分布式环境下，怎么产生类似单机的一致性ID？
- 建一个单点系统，专门产生一致性ID



